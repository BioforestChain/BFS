<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Hio</title>
    <style>
      #box {
        display: inline-block;
        width: 100px;
        height: 100px;
        background: blue;
        position: absolute;
        z-index: -1;
      }
      .panel {
        position: relative;
        z-index: 2;
        background: rgba(13, 255, 0, 0.326);
      }
    </style>
  </head>
  <body>
    <h1>HIIIIII</h1>
    <div id="box"></div>
    <div class="panel">
      <input id="box_x" type="range" value="10" min="0" step="1" />
      <input id="box_y" type="range" value="10" min="0" step="1" />
      <button id="reloder">reload</button>
    </div>
  </body>
  <script>
    box_x.max = innerWidth - 100;
    box_y.max = innerHeight - 100;

    let emited = false;
    const emitBoxChanged = () => {
      if (emited) {
        return;
      }
      emited = true;
      queueMicrotask(() => {
        emited = false;
        window.__box__?.emit(parseFloat(preX) || 0, parseFloat(preY) || 0);
      });
    };

    let preX = "";
    (box_x.oninput = () => {
      const newX = box_x.value + "px";
      if (newX !== preX) {
        box.style.left = preX = newX;
        emitBoxChanged();
      }
    })();

    let preY = "";
    (box_y.oninput = () => {
      const newY = box_y.value + "px";
      if (newY !== preY) {
        box.style.top = preY = newY;
        emitBoxChanged();
      }
    })();
    reloder.onclick = () => {
      location.reload();
    };

    // const ob = new IntersectionObserver((entries) => {
    //   for (const entry of entries) {
    //     console.log(entry.boundingClientRect.toJSON());
    //   }
    // });
    // ob.observe(box);
    // ob.
  </script>
</html>
