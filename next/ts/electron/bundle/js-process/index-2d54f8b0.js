(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const v=()=>(n,e,t)=>{const i=t.get;if(i===void 0)throw new Error(`${n}.${e} should has getter`);return t.get=function(){const s=i.call(this);return t.set?t.get=()=>s:(delete t.set,delete t.get,t.value=s,t.writable=!1),Object.defineProperty(this,e,t),s},t};var w=Object.defineProperty,E=Object.getOwnPropertyDescriptor,P=(n,e,t,i)=>{for(var s=i>1?void 0:i?E(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&w(e,t,s),s};const L=n=>new m(n);class m{constructor(e=!0){this._cbs=new Set,this._started=!1,this.start=()=>{if(!this._started&&(this._started=!0,this._cachedEmits.length)){for(const t of this._cachedEmits)this._emit(t);this._cachedEmits.length=0}},this.listen=t=>(this._cbs.add(t),this.start(),()=>this._cbs.delete(t)),this.emit=(...t)=>{this._started?this._emit(t):this._cachedEmits.push(t)},this._emit=t=>{for(const i of this._cbs)i.apply(null,t)},this.clear=()=>{this._cbs.clear()},e&&this.start()}get _cachedEmits(){return[]}}P([v()],m.prototype,"_cachedEmits",1);const b=n=>n instanceof Object&&typeof n.then=="function";class u{constructor(){this.is_resolved=!1,this.is_rejected=!1,this.is_finished=!1,this.promise=new Promise((e,t)=>{this.resolve=i=>{try{b(i)?i.then(this.resolve,this.reject):(this.is_resolved=!0,this.is_finished=!0,e(this.value=i),this._runThen(),this._innerFinallyArg=Object.freeze({status:"resolved",result:this.value}),this._runFinally())}catch(s){this.reject(s)}},this.reject=i=>{this.is_rejected=!0,this.is_finished=!0,t(this.reason=i),this._runCatch(),this._innerFinallyArg=Object.freeze({status:"rejected",reason:this.reason}),this._runFinally()}})}static resolve(e){const t=new u;return t.resolve(e),t}static sleep(e){const t=new u;let i=setTimeout(()=>{i=void 0,t.resolve()},e);return t.onFinished(()=>i!==void 0&&clearTimeout(i)),t}onSuccess(e){this.is_resolved?this.__callInnerThen(e):(this._innerThen||(this._innerThen=[])).push(e)}onError(e){this.is_rejected?this.__callInnerCatch(e):(this._innerCatch||(this._innerCatch=[])).push(e)}onFinished(e){this.is_finished?this.__callInnerFinally(e):(this._innerFinally||(this._innerFinally=[])).push(e)}_runFinally(){if(this._innerFinally){for(const e of this._innerFinally)this.__callInnerFinally(e);this._innerFinally=void 0}}__callInnerFinally(e){queueMicrotask(async()=>{try{await e(this._innerFinallyArg)}catch(t){console.error("Unhandled promise rejection when running onFinished",e,t)}})}_runThen(){if(this._innerThen){for(const e of this._innerThen)this.__callInnerThen(e);this._innerThen=void 0}}_runCatch(){if(this._innerCatch){for(const e of this._innerCatch)this.__callInnerCatch(e);this._innerCatch=void 0}}__callInnerThen(e){queueMicrotask(async()=>{try{await e(this.value)}catch(t){console.error("Unhandled promise rejection when running onSuccess",e,t)}})}__callInnerCatch(e){queueMicrotask(async()=>{try{await e(this.value)}catch(t){console.error("Unhandled promise rejection when running onError",e,t)}})}}const p=new Map;let j=0;const O=()=>j++,F=async(n,e,t,i,s=new URL(n).hostname)=>{const r=O(),o=URL.createObjectURL(new Blob([`import("${n}")
        .then(
          async({installEnv,Metadata})=>{
            void installEnv(new Metadata(${e},${t}));
            postMessage("ready")
          },
          (err)=>postMessage("ERROR:"+err)
        )`],{type:"text/javascript"})),c=new Worker(o,{type:"module",name:s});await new Promise((l,h)=>{c.addEventListener("message",_=>{_.data==="ready"?l():h(_.data)},{once:!0})}),c.postMessage(["fetch-ipc-channel",i],[i]);const d=new u,a=l=>{Array.isArray(l.data)&&l.data[0]==="env-ready"&&d.resolve()};return c.addEventListener("message",a),await d.promise,c.removeEventListener("message",a),p.set(r,{worker:c,fetch_port:i}),g.emit({process_id:r,env_script_url:n}),{process_id:r}},R=async(n,e,t,i="{}")=>{const s=f(n);s.worker.postMessage(["ipc-connect",e,i],[t]);const r=new u,o=c=>{Array.isArray(c.data)&&c.data[0]==="ipc-connect-ready"&&c.data[1]===e&&r.resolve()};s.worker.addEventListener("message",o),await r.promise,s.worker.removeEventListener("message",o)},f=n=>{const e=p.get(n);if(e===void 0)throw new Error(`no found worker by id: ${n}`);return e},T=(n,e)=>{f(n).worker.postMessage(["run-main",e])},I=n=>{f(n).worker.terminate()},g=L(),C={createProcess:F,runProcessMain:T,createIpc:R,destroyProcess:I};Object.assign(globalThis,C);const M=String.raw;g.listen(({process_id:n,env_script_url:e})=>{document.body.innerHTML+=M`<div>
    <span>PID:${n}</span>
    <span>URL:${e}</span>
  </div>`});const S="modulepreload",A=function(n,e){return new URL(n,e).href},y={},$=function(e,t,i){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=A(r,i),r in y)return;y[r]=!0;const o=r.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(!!i)for(let l=s.length-1;l>=0;l--){const h=s[l];if(h.href===r&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${c}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":S,o||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),o)return new Promise((l,h)=>{a.addEventListener("load",l),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())};"ipcRenderer"in self&&(async()=>{const{exportApis:n}=await $(()=>import("./openNativeWindow.preload-8ffb0aa6.js"),[],import.meta.url);n(globalThis)})();
