<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>js process</title>
    <script type="module" src="./js-process.web.ts"></script>
    <script>
      try {
        const { ipcRenderer } = require("electron");
        console.log(ipcRenderer);
        Object.assign(globalThis, {
          ipcRenderer,
        });
      } catch {}
    </script>
    <script type="module" src="./exportApis.ts"></script>
  </head>
  <body>
    <h1>这里运行着所有的 后端 JS 进程</h1>
    <button>点击-</button>
    <!-- <script type="text/javascript">
      // console.log('aa')
      const btn = document.querySelector('button')
      btn.addEventListener('click', click)
      function click(){
        console.log('点击了')
        fetch("https://api.js.sys.dweb-80.localhost:22605/open")
        .then(
          res => console.log('res: ', res),
          err => console.error('err: ', err)
        )
      }
    </script> -->

    <!-- <button onclick="openBrowserWindow()">
      启动 borser.window 1
    </button>
    <button onclick="openOtherBrowserWindow()">
      启动 desktop_2.worker.js
    </button>
    <button onclick="openDesktopBrowserWindow()">
      启动 desktop.sys.dweb
    </button>
    <button onclick="openTestBrowserWindow()">
      启动 test 4
    </button>
    <button onclick="closeBrowserWindow()">
      关闭 borser.window
    </button>
    <script type="text/javascript">
      async function openBrowserWindow(){
        // 启动之前必须要先实例化 borser 然后再 install 、open
        const mmid = "browser.sys.dweb"
        const root = "file:///bundle"
        const entry = "/browser.worker.js";
        const url = `http://api.js.sys.dweb-80.localhost:22605/open?mmid=${mmid}&root=${root}&entry=${entry}`
        const res = await fetch(url)
        console.log('res: ', JSON.parse( await res.json()))
      }

      async function openOtherBrowserWindow(){
        // 启动之前必须要先实例化 borser 然后再 install 、open
        const mmid = `browser.2.sys.dweb`
        const root = "file:///bundle"
        // const entry = "/browser.worker.js";
        const entry = "/desktop_2.worker.js" // 采用desktop的worker.js
        const url = `http://api.js.sys.dweb-80.localhost:22605/open?mmid=${mmid}&root=${root}&entry=${entry}`
        const res = await fetch(url)
        console.log('res: ', JSON.parse( await res.json()))
      }

      async function openDesktopBrowserWindow(){
        // 启动之前必须要先实例化 borser 然后再 install 、open
        const mmid = `desktop.sys.dweb`
        const root = "file:///bundle"
        const entry = "/desktop.worker.js";
        const url = `http://api.js.sys.dweb-80.localhost:22605/open?mmid=${mmid}&root=${root}&entry=${entry}`
        const res = await fetch(url)
        console.log('res: ', JSON.parse( await res.json()))
      }

      async function openTestBrowserWindow(){
        // 启动之前必须要先实例化 borser 然后再 install 、open
        const mmid = `test.sys.dweb`
        const root = "file:///bundle"
        const entry = "/test.worker.js";
        const url = `http://api.js.sys.dweb-80.localhost:22605/open?mmid=${mmid}&root=${root}&entry=${entry}`
        const res = await fetch(url)
        console.log('res: ', JSON.parse( await res.json()))
      }


      async function closeBrowserWindow(){
        const url = `http://api.js.sys.dweb-80.localhost:22605/close?mmid=browser.sys.dweb`
        const res = await fetch(url)
        console.log('res: ', await res.json())
      }
    </script> -->
  </body>
</html>
